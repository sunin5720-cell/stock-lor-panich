<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‚≠ê ‡∏•‡πâ‡∏≠‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå ‚≠ê</title>

  <!-- Canva SDK (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Canva ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏Å‡πá‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ) -->
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Tailwind (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Canva ‡∏Å‡πá‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ) -->
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>

  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Sarabun', 'Noto Sans Thai', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #ffc3e1 0%, #ffe5f0 100%);
      min-height: 100%;
      height: 100%;
    }

    html {
      height: 100%;
    }

    * {
      box-sizing: border-box;
    }

    @keyframes fadeInSlideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    @keyframes modalImageZoom {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0) 20%),
        linear-gradient(135deg, #ff69b4 0%, #ff1493 30%, #c71585 60%, #ff1493 80%, #ff69b4 100%);
      border-radius: 25px;
      padding: 45px 30px 40px 30px;
      margin-bottom: 20px;
      box-shadow: 0 8px 35px rgba(255, 105, 180, 0.5), 0 2px 15px rgba(255, 255, 255, 0.2) inset;
      text-align: center;
      animation: fadeInSlideUp 0.6s ease-out;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 30px;
      width: 50px;
      height: 50px;
      opacity: 0.15;
      animation: fadeInSlideDown 1.2s ease-out;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
    }

    .header::after {
      content: '';
      position: absolute;
      top: 20px;
      right: 30px;
      width: 50px;
      height: 50px;
      opacity: 0.15;
      animation: fadeInSlideDown 1.4s ease-out;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
    }

    .header h1 {
      margin: 0 0 15px 0;
      color: white;
      font-size: 36px;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), 0 4px 15px rgba(255, 255, 255, 0.3);
      animation: fadeInSlideDown 0.8s ease-out;
      font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
    }

    .shop-badge {
      display: inline-block;
      margin: 0 0 20px 0;
      padding: 12px 35px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.15) 100%);
      backdrop-filter: blur(15px);
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 50px;
      color: #ffd700;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 3px;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(255, 255, 255, 0.3) inset;
      animation: fadeInSlideDown 1s ease-out;
      position: relative;
      overflow: hidden;
      font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
    }

    .controls-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(255, 105, 180, 0.15);
      animation: fadeInSlideUp 0.8s ease-out;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .controls-card:hover {
      box-shadow: 0 8px 30px rgba(255, 105, 180, 0.25);
      transform: translateY(-2px);
    }

    .search-filter-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
      max-width: 600px;
    }

    .search-box input {
      width: 100%;
      padding: 14px 20px;
      border: 2px solid #ffc3e1;
      border-radius: 15px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    .search-box input:focus {
      border-color: #ff69b4;
      box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.15);
      transform: translateY(-1px);
    }

    .search-box input:hover {
      border-color: #ff69b4;
    }

    .filter-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-select {
      padding: 14px 25px;
      border: 2px solid #ffc3e1;
      border-radius: 15px;
      background: white;
      color: #ff69b4;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      outline: none;
      transition: all 0.3s;
      min-width: 220px;
    }

    .filter-select:hover {
      background: #fff0f7;
      border-color: #ff69b4;
    }

    .filter-select:focus {
      border-color: #ff69b4;
      box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.1);
    }

    .admin-btn {
      padding: 14px 40px;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 30px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.15) 100%);
      backdrop-filter: blur(15px);
      color: white;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2), 0 2px 8px rgba(255, 255, 255, 0.3) inset;
      display: inline-block;
      position: relative;
      overflow: hidden;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .admin-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }

    .admin-btn:hover::before {
      left: 100%;
    }

    .admin-btn:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.25) 100%);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3), 0 2px 10px rgba(255, 255, 255, 0.4) inset;
      border-color: rgba(255, 255, 255, 0.8);
    }

    .admin-btn:active {
      transform: translateY(-1px) scale(1.02);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .header-subtitle {
      margin: 15px 0 0 0;
      color: rgba(255, 255, 255, 0.85);
      font-size: 14px;
      font-weight: 500;
      letter-spacing: 1px;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      animation: fadeInSlideDown 1.2s ease-out;
    }

    .table-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(255, 105, 180, 0.15);
      overflow-x: auto;
      animation: fadeInSlideUp 1s ease-out;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .table-card:hover {
      box-shadow: 0 8px 30px rgba(255, 105, 180, 0.25);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead th {
      background: #ff1493;
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 700;
      font-size: 16px;
      white-space: nowrap;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    thead th:first-child {
      border-top-left-radius: 12px;
    }

    thead th:last-child {
      border-top-right-radius: 12px;
    }

    tbody tr {
      border-bottom: 1px solid #ffe5f0;
      transition: background 0.25s ease, transform 0.2s ease;
      animation: fadeInSlideUp 0.4s ease-out backwards;
    }

    tbody tr:nth-child(1) { animation-delay: 0.05s; }
    tbody tr:nth-child(2) { animation-delay: 0.1s; }
    tbody tr:nth-child(3) { animation-delay: 0.15s; }
    tbody tr:nth-child(4) { animation-delay: 0.2s; }
    tbody tr:nth-child(5) { animation-delay: 0.25s; }
    tbody tr:nth-child(n+6) { animation-delay: 0.3s; }

    tbody tr:hover {
      background: #fff5fa;
      transform: translateY(-1px);
    }

    tbody td {
      padding: 15px;
      color: #333;
      font-size: 15px;
    }

    .product-image {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      border: 2px solid #ffe5f0;
    }

    .product-image:hover {
      transform: scale(1.12);
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
      border-color: #ff69b4;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 700;
      white-space: nowrap;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .status-badge:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.18);
    }

    .status-ready {
      background: linear-gradient(135deg, #b3e5fc 0%, #c8e6c9 100%);
      color: #1b5e20;
    }

    .status-out {
      background: linear-gradient(135deg, #e1bee7 0%, #f8bbd0 100%);
      color: #6a1b9a;
    }

    .status-warehouse {
      background: linear-gradient(135deg, #fff9c4 0%, #ffccbc 100%);
      color: #e65100;
    }

    .status-shipping {
      background: linear-gradient(135deg, #b3e5fc 0%, #d1c4e9 100%);
      color: #4527a0;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
      animation: modalFadeIn 0.3s ease-out;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      max-width: 90%;
      max-height: 90%;
      text-align: center;
      animation: modalImageZoom 0.4s ease-out;
    }

    .modal-content img {
      max-width: 100%;
      max-height: 70%;
      border-radius: 15px;
    }

    .modal-close {
      margin-top: 20px;
      padding: 10px 30px;
      border: none;
      border-radius: 15px;
      background: #ff69b4;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .modal-close:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
    }

    .modal-close:active {
      transform: scale(0.97);
    }

    .login-container {
      display: none;
      min-height: 100%;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: modalFadeIn 0.4s ease-out;
    }

    .login-card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 4px 30px rgba(255, 105, 180, 0.2);
      max-width: 450px;
      width: 100%;
      animation: modalImageZoom 0.5s ease-out;
    }

    .login-card h2 {
      color: #ff69b4;
      margin: 0 0 30px 0;
      text-align: center;
      font-size: 28px;
      animation: fadeInSlideDown 0.6s ease-out;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: #ff69b4;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 15px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #ffc3e1;
      border-radius: 15px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      border-color: #ff69b4;
      box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.15);
      transform: translateY(-1px);
    }

    .form-group select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #ffc3e1;
      border-radius: 15px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      background: white;
      cursor: pointer;
    }

    .form-group select:focus {
      border-color: #ff69b4;
      box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.15);
      transform: translateY(-1px);
    }

    .form-group select:hover {
      border-color: #ff69b4;
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 15px;
      background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
      margin-top: 10px;
    }

    .login-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(255, 105, 180, 0.5);
    }

    .login-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 3px 10px rgba(255, 105, 180, 0.3);
    }

    .back-btn {
      width: 100%;
      padding: 12px;
      border: 2px solid #ff69b4;
      border-radius: 15px;
      background: white;
      color: #ff69b4;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      margin-top: 15px;
    }

    .back-btn:hover {
      background: #fff0f7;
      transform: scale(1.02);
      box-shadow: 0 2px 10px rgba(255, 105, 180, 0.2);
    }

    .back-btn:active {
      transform: scale(0.98);
    }

    .admin-container {
      display: none;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logout-btn {
      padding: 10px 25px;
      border: 2px solid #ff69b4;
      border-radius: 15px;
      background: white;
      color: #ff69b4;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .logout-btn:hover {
      background: #fff0f7;
      transform: scale(1.04);
      box-shadow: 0 2px 10px rgba(255, 105, 180, 0.2);
    }

    .logout-btn:active {
      transform: scale(0.97);
    }

    .form-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(255, 105, 180, 0.15);
      animation: fadeInSlideUp 0.9s ease-out;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .form-card:hover {
      box-shadow: 0 8px 30px rgba(255, 105, 180, 0.25);
      transform: translateY(-2px);
    }

    .form-card h3 {
      color: #ff69b4;
      margin: 0 0 25px 0;
      font-size: 22px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .submit-btn {
      padding: 14px 40px;
      border: none;
      border-radius: 15px;
      background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .submit-btn:hover {
      background: linear-gradient(135deg, #ff1493 0%, #c71585 100%);
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 6px 20px rgba(255, 105, 180, 0.6);
    }

    .submit-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 3px 10px rgba(255, 105, 180, 0.3);
    }

    .action-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-right: 8px;
    }

    .edit-btn {
      background: linear-gradient(135deg, #ffb3d9 0%, #ffc3e1 100%);
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    }

    .edit-btn:hover {
      background: linear-gradient(135deg, #ff99cc 0%, #ffaad5 100%);
      transform: scale(1.08);
      box-shadow: 0 3px 12px rgba(255, 105, 180, 0.4);
    }

    .edit-btn:active {
      transform: scale(0.95);
    }

    .delete-btn {
      background: linear-gradient(135deg, #c71585 0%, #d946a6 100%);
      color: white;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    }

    .delete-btn:hover {
      background: linear-gradient(135deg, #a0116b 0%, #c71585 100%);
      transform: scale(1.08);
      box-shadow: 0 3px 12px rgba(199, 21, 133, 0.5);
    }

    .delete-btn:active {
      transform: scale(0.95);
    }

    .refresh-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 15px;
      background: linear-gradient(135deg, #d946a6 0%, #ba68c8 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 15px rgba(217, 70, 166, 0.4);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .refresh-btn:hover {
      background: linear-gradient(135deg, #c71585 0%, #ab47bc 100%);
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 6px 20px rgba(217, 70, 166, 0.6);
    }

    .refresh-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 3px 10px rgba(217, 70, 166, 0.3);
    }

    .last-updated {
      text-align: center;
      margin: 20px auto 0 auto;
      padding: 12px 24px;
      background: linear-gradient(135deg, #fff0f7 0%, #ffe5f0 100%);
      border-radius: 16px;
      color: #ff69b4;
      font-size: 14px;
      font-weight: 600;
      font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
      box-shadow: 0 2px 8px rgba(255, 105, 180, 0.12);
      display: table;
    }

    .swal2-popup {
      border-radius: 20px;
    }

    .swal2-confirm {
      border-radius: 15px;
      background: #ff69b4 !important;
    }

    .swal2-cancel {
      border-radius: 15px;
    }

    .theme-toggle-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border: 2px solid rgba(255, 255, 255, 0.7);
      border-radius: 25px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.1) 100%);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 10;
    }

    .theme-toggle-btn:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.35) 0%, rgba(255, 255, 255, 0.2) 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      border-color: rgba(255, 255, 255, 0.9);
    }

    .theme-toggle-btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }

    .theme-icon {
      font-size: 18px;
      display: inline-block;
    }

    .theme-text {
      font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 24px;
      }

      .header p {
        font-size: 18px;
      }

      .search-filter-row {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        min-width: 100%;
      }

      .filter-select {
        min-width: 100%;
      }

      table {
        font-size: 14px;
      }

      .table-card {
        padding: 15px;
      }

      tbody td {
        padding: 10px 8px;
      }

      .product-image {
        width: 48px;
        height: 48px;
      }

      .theme-toggle-btn {
        top: 15px;
        right: 15px;
        padding: 8px 16px;
        font-size: 14px;
      }

      .theme-icon {
        font-size: 16px;
      }
    }

    /* Dark Mode Styles */
    body.dark-mode {
      background: linear-gradient(135deg, #2d1b4e 0%, #1a1a2e 100%);
    }

    body.dark-mode .header {
      background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 20%),
        linear-gradient(135deg, #4a148c 0%, #6a1b9a 30%, #7b1fa2 60%, #6a1b9a 80%, #4a148c 100%);
      box-shadow: 0 8px 35px rgba(106, 27, 154, 0.6), 0 2px 15px rgba(255, 255, 255, 0.1) inset;
    }

    body.dark-mode .shop-badge {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
      border: 2px solid rgba(255, 215, 0, 0.6);
      color: #ffd700;
    }

    body.dark-mode .header-subtitle {
      color: rgba(255, 255, 255, 0.75);
    }

    body.dark-mode .controls-card,
    body.dark-mode .table-card,
    body.dark-mode .form-card,
    body.dark-mode .login-card {
      background: #2a2a3e;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    body.dark-mode .controls-card:hover,
    body.dark-mode .table-card:hover,
    body.dark-mode .form-card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
    }

    body.dark-mode .search-box input,
    body.dark-mode .filter-select,
    body.dark-mode .form-group input,
    body.dark-mode .form-group select {
      background: #1a1a2e;
      border: 2px solid #6a1b9a;
      color: #e0e0e0;
    }

    body.dark-mode .search-box input::placeholder {
      color: #888;
    }

    body.dark-mode .search-box input:focus,
    body.dark-mode .filter-select:focus,
    body.dark-mode .form-group input:focus,
    body.dark-mode .form-group select:focus {
      border-color: #ab47bc;
      box-shadow: 0 0 0 4px rgba(171, 71, 188, 0.3);
    }

    body.dark-mode .search-box input:hover,
    body.dark-mode .filter-select:hover,
    body.dark-mode .form-group input:hover,
    body.dark-mode .form-group select:hover {
      border-color: #ab47bc;
    }

    body.dark-mode thead th {
      background: #6a1b9a;
      color: white;
    }

    body.dark-mode tbody tr {
      border-bottom: 1px solid #3a3a4e;
    }

    body.dark-mode tbody tr:hover {
      background: #3a3a4e;
    }

    body.dark-mode tbody td {
      color: #e0e0e0;
    }

    body.dark-mode .product-image {
      border: 2px solid #6a1b9a;
    }

    body.dark-mode .product-image:hover {
      border-color: #ab47bc;
      box-shadow: 0 4px 15px rgba(171, 71, 188, 0.5);
    }

    body.dark-mode .last-updated {
      background: linear-gradient(135deg, #3a3a4e 0%, #2a2a3e 100%);
      color: #ab47bc;
    }

    body.dark-mode .form-card h3,
    body.dark-mode .controls-card h3,
    body.dark-mode .login-card h2 {
      color: #ce93d8;
    }

    body.dark-mode .form-group label {
      color: #ce93d8;
    }

    body.dark-mode .modal {
      background: rgba(0, 0, 0, 0.85);
    }

    body.dark-mode .modal-content {
      background: #2a2a3e;
    }

    body.dark-mode .modal-close {
      background: #6a1b9a;
    }

    body.dark-mode .modal-close:hover {
      box-shadow: 0 4px 15px rgba(106, 27, 154, 0.6);
    }

    body.dark-mode #viewerPagination {
      border-top: 2px solid #3a3a4e;
    }

    body.dark-mode #pageInfo {
      color: #ce93d8;
    }

    body.dark-mode .status-ready {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
      color: #c8e6c9;
    }

    body.dark-mode .status-out {
      background: linear-gradient(135deg, #4a148c 0%, #6a1b9a 100%);
      color: #e1bee7;
    }

    body.dark-mode .status-warehouse {
      background: linear-gradient(135deg, #e65100 0%, #f57c00 100%);
      color: #ffe0b2;
    }

    body.dark-mode .status-shipping {
      background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%);
      color: #bbdefb;
    }

    body.dark-mode .swal2-popup {
      background: #2a2a3e;
      color: #e0e0e0;
    }

    body.dark-mode .swal2-title {
      color: #ce93d8;
    }

    body.dark-mode .swal2-html-container {
      color: #e0e0e0;
    }

    body.dark-mode .swal2-input,
    body.dark-mode .swal2-select {
      background: #1a1a2e;
      border: 1px solid #6a1b9a;
      color: #e0e0e0;
    }

    body.dark-mode .swal2-input:focus,
    body.dark-mode .swal2-select:focus {
      border-color: #ab47bc;
      box-shadow: 0 0 0 3px rgba(171, 71, 188, 0.3);
    }

    body.dark-mode .swal2-confirm {
      background: #6a1b9a !important;
    }

    body.dark-mode .swal2-cancel {
      background: #424242;
      color: #e0e0e0;
    }

    body.dark-mode .swal2-validation-message {
      background: #d32f2f;
      color: white;
    }
  </style>

  <style>
    @view-transition {
      navigation: auto;
    }
  </style>
</head>
<body>
  <!-- Viewer Section -->
  <div id="viewerSection">
    <div class="container">
      <div class="header">
        <button class="theme-toggle-btn" id="themeToggleViewer" aria-label="Toggle Dark Mode">
          <span class="theme-icon">üåô</span>
          <span class="theme-text">Dark</span>
        </button>
        <h1 id="pageTitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <div class="shop-badge" id="shopName">‚≠ê ‡∏•‡πâ‡∏≠‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå ‚≠ê</div>
        <div>
          <button class="admin-btn" id="goToAdminBtn">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="18" height="18"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 style="display:inline-block;vertical-align:middle;margin-right:8px;">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
            <span style="display:inline-block;vertical-align:middle;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</span>
          </button>
          <p class="header-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        </div>
      </div>

      <div class="controls-card">
        <div class="search-filter-row">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." />
          </div>
          <div class="filter-group">
            <select class="filter-select" id="statusFilterSelect">
              <option value="all">üìã ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <option value="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á">‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</option>
              <option value="‡∏´‡∏°‡∏î">‚ö†Ô∏è ‡∏´‡∏°‡∏î</option>
              <option value="‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢">üì¶ ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢</option>
              <option value="‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">üöö ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
            </select>
          </div>
        </div>
      </div>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>üñºÔ∏è ‡∏£‡∏π‡∏õ</th>
              <th>üè∑Ô∏è ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>üì¶ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>‚ú® ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            </tr>
          </thead>
          <tbody id="viewerTableBody">
            <tr>
              <td colspan="5" style="text-align:center;padding:40px;color:#999;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
            </tr>
          </tbody>
        </table>

        <div id="viewerPagination"
             style="display:none;justify-content:center;align-items:center;gap:15px;margin-top:20px;padding-top:20px;border-top:2px solid #ffe5f0;">
          <button id="prevPageBtn" class="action-btn edit-btn" style="margin:0;">‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
          <span id="pageInfo" style="color:#ff69b4;font-weight:600;font-size:16px;">‡∏´‡∏ô‡πâ‡∏≤ 1 / 1</span>
          <button id="nextPageBtn" class="action-btn edit-btn" style="margin:0;">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂</button>
        </div>

        <div id="lastUpdatedViewer" class="last-updated"></div>
      </div>
    </div>
  </div>

  <!-- Login Section -->
  <div class="login-container" id="loginSection">
    <div class="login-card">
      <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="adminId">Admin ID</label>
          <input type="text" id="adminId" required />
        </div>
        <div class="form-group">
          <label for="adminPassword">Password</label>
          <input type="password" id="adminPassword" required />
        </div>
        <button type="submit" class="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        <button type="button" class="back-btn" id="backToViewerBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
      </form>
    </div>
  </div>

  <!-- Admin Section -->
  <div class="admin-container" id="adminSection">
    <div class="container">
      <div class="header">
        <button class="theme-toggle-btn" id="themeToggleAdmin" aria-label="Toggle Dark Mode">
          <span class="theme-icon">üåô</span>
          <span class="theme-text">Dark</span>
        </button>

        <div class="admin-header" style="display:flex;width:100%;justify-content:space-between;align-items:center;">
          <div>
            <h1 id="adminPageTitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <div class="shop-badge" id="adminShopName">‚≠ê ‡∏•‡πâ‡∏≠‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå ‚≠ê</div>
          </div>
          <button class="logout-btn" id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>

      <div class="form-card" id="addProductCard" style="display:none;">
        <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="addProductForm">
          <div class="form-row">
            <div class="form-group">
              <label for="addSku">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
              <input type="text" id="addSku" required />
            </div>
            <div class="form-group">
              <label for="addName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
              <input type="text" id="addName" required />
            </div>
            <div class="form-group">
              <label for="addQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
              <input type="number" id="addQuantity" min="0" value="0" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="addStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ *</label>
              <select id="addStatus" required>
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
                <option value="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á">‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</option>
                <option value="‡∏´‡∏°‡∏î">‚ö†Ô∏è ‡∏´‡∏°‡∏î</option>
                <option value="‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢">üì¶ ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢</option>
                <option value="‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">üöö ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
              </select>
            </div>
            <div class="form-group">
              <label for="addImageUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ *</label>
              <input type="url" id="addImageUrl"
                     placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive ‡πÅ‡∏ö‡∏ö /file/d/.../view ‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
                     required />
            </div>
          </div>

          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button type="submit" class="submit-btn">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button type="button" class="back-btn" id="cancelAddBtn"
                    style="width:auto;padding:14px 40px;margin-top:0;">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        </form>
      </div>

      <div class="controls-card">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;">
          <h3 style="color:#ff69b4;margin:0;">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="submit-btn" id="toggleAddFormBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="refresh-btn" id="refreshBtn">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
          </div>
        </div>
      </div>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>üñºÔ∏è ‡∏£‡∏π‡∏õ</th>
              <th>üè∑Ô∏è ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>üì¶ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>‚ú® ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="adminTableBody">
            <tr>
              <td colspan="6" style="text-align:center;padding:40px;color:#999;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
            </tr>
          </tbody>
        </table>

        <div id="lastUpdatedAdmin" class="last-updated"></div>
      </div>
    </div>
  </div>

  <!-- Image Modal -->
  <div class="modal" id="imageModal">
    <div class="modal-content">
      <img id="modalImage" src="" alt="Product Image" />
      <button class="modal-close" id="closeModal">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <script>
    const defaultConfig = {
      page_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
      shop_name: "‡∏•‡πâ‡∏≠‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå"
    };

    // *** ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™ admin ‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
    const ADMIN_ID = "3333333333*";
    const ADMIN_PASSWORD = "3333333333*";

    // URL Google Apps Script
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxzN1MfxYF9kGIC5HYGZ33ZSMfx4oCGoeMjsNoGzZZ2xAzGnXNqTuv0Ab5LsSaKh9tn/exec";

    let allProducts = [];
    let currentFilter = "all";
    let lastUpdated = null;
    const ITEMS_PER_PAGE = 50;
    let currentViewerPage = 1;

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text ?? '';
      return div.innerHTML;
    }

    function safeProduct(product) {
      return {
        sku: product.sku || "",
        name: product.name || "",
        quantity: product.quantity != null ? product.quantity : 0,
        status: product.status || "",
        imageUrl: product.imageUrl || ""
      };
    }

    function normalizeImageUrl(url) {
      if (!url || typeof url !== 'string') return url;
      const drivePattern = /drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/;
      const match = url.match(drivePattern);
      if (match && match[1]) {
        return `https://lh3.googleusercontent.com/d/${match[1]}`;
      }
      return url;
    }

    function getStatusBadge(status) {
      const statusLower = (status || '').toLowerCase();
      let className = '';
      let emoji = '';
      let text = '';

      if (statusLower.includes('‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á')) {
        className = 'status-ready';
        emoji = '‚ú®';
        text = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á';
      } else if (statusLower.includes('‡∏´‡∏°‡∏î')) {
        className = 'status-out';
        emoji = '‚ö†Ô∏è';
        text = '‡∏´‡∏°‡∏î';
      } else if (statusLower.includes('‡πÇ‡∏Å‡∏î‡∏±‡∏á')) {
        className = 'status-warehouse';
        emoji = 'üì¶';
        text = '‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢';
      } else if (statusLower.includes('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á')) {
        className = 'status-shipping';
        emoji = 'üöö';
        text = '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á';
      } else {
        className = 'status-ready';
        emoji = '‚ú®';
        text = status || '';
      }

      return `<span class="status-badge ${className}">${emoji} ${escapeHtml(text)}</span>`;
    }

    function loadProducts(callback) {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      const callbackName = 'jsonpCallback_' + Date.now();
      window[callbackName] = function (response) {
        delete window[callbackName];
        document.body.removeChild(script);
        Swal.close();

        if (response && response.ok) {
          allProducts = response.data || [];
          lastUpdated = new Date();
          if (callback) callback();
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: response?.msg || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
            confirmButtonColor: '#ff69b4'
          });
        }
      };

      const script = document.createElement('script');
      script.src = `${APPS_SCRIPT_URL}?action=list&callback=${callbackName}`;
      script.onerror = function () {
        delete window[callbackName];
        Swal.close();
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#ff69b4'
        });
      };
      document.body.appendChild(script);
    }

    function updateLastUpdatedText() {
      if (!lastUpdated) return;

      const dateStr = lastUpdated.toLocaleString('th-TH', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });

      const timeStr = lastUpdated.toLocaleString('th-TH', {
        hour: '2-digit',
        minute: '2-digit'
      });

      const displayText = `‚è∞ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î : ${dateStr} ‚Ä¢ ${timeStr} ‡∏ô.`;

      const viewerEl = document.getElementById('lastUpdatedViewer');
      const adminEl = document.getElementById('lastUpdatedAdmin');

      if (viewerEl) viewerEl.textContent = displayText;
      if (adminEl) adminEl.textContent = displayText;
    }

    function filterAndRenderViewer() {
      const searchTerm = (document.getElementById('searchInput').value || '').toLowerCase();
      let filtered = allProducts.slice();

      if (currentFilter !== 'all') {
        filtered = filtered.filter(p => {
          const safe = safeProduct(p);
          return safe.status === currentFilter;
        });
      }

      if (searchTerm) {
        filtered = filtered.filter(p => {
          const safe = safeProduct(p);
          return safe.sku.toLowerCase().includes(searchTerm) ||
                 safe.name.toLowerCase().includes(searchTerm);
        });
      }

      const totalPages = Math.ceil(filtered.length / ITEMS_PER_PAGE);
      if (currentViewerPage > totalPages && totalPages > 0) {
        currentViewerPage = 1;
      }

      const start = (currentViewerPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageData = filtered.slice(start, end);

      const tbody = document.getElementById('viewerTableBody');

      if (!filtered.length) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:40px;color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</td></tr>';
        updatePaginationControls(0, 0);
        updateLastUpdatedText();
        return;
      }

      tbody.innerHTML = pageData.map(product => {
        const safe = safeProduct(product);
        const imageUrl = normalizeImageUrl(safe.imageUrl);
        const imgEsc = escapeHtml(imageUrl);
        return `
          <tr>
            <td>
              <img src="${imgEsc}" alt="${escapeHtml(safe.name)}"
                   class="product-image" onclick="openImageModal('${imgEsc}')">
            </td>
            <td>${escapeHtml(safe.sku)}</td>
            <td>${escapeHtml(safe.name)}</td>
            <td>${escapeHtml(String(safe.quantity))}</td>
            <td>${getStatusBadge(safe.status)}</td>
          </tr>
        `;
      }).join('');

      updatePaginationControls(currentViewerPage, totalPages);
      updateLastUpdatedText();
    }

    function updatePaginationControls(currentPage, totalPages) {
      const paginationEl = document.getElementById('viewerPagination');
      if (!paginationEl) return;

      if (totalPages <= 1) {
        paginationEl.style.display = 'none';
        return;
      }

      paginationEl.style.display = 'flex';
      document.getElementById('pageInfo').textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage} / ${totalPages}`;
      document.getElementById('prevPageBtn').disabled = currentPage <= 1;
      document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;
    }

    function renderAdminTable() {
      const tbody = document.getElementById('adminTableBody');
      if (!allProducts.length) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</td></tr>';
        updateLastUpdatedText();
        return;
      }

      tbody.innerHTML = allProducts.map((product, index) => {
        const safe = safeProduct(product);
        const imageUrl = normalizeImageUrl(safe.imageUrl);
        const imgEsc = escapeHtml(imageUrl);
        return `
          <tr>
            <td>
              <img src="${imgEsc}" alt="${escapeHtml(safe.name)}"
                   class="product-image" onclick="openImageModal('${imgEsc}')">
            </td>
            <td>${escapeHtml(safe.sku)}</td>
            <td>${escapeHtml(safe.name)}</td>
            <td>${escapeHtml(String(safe.quantity))}</td>
            <td>${getStatusBadge(safe.status)}</td>
            <td>
              <button class="action-btn edit-btn" onclick="editProduct(${index})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="action-btn delete-btn" onclick="deleteProduct('${escapeHtml(safe.sku)}')">üóëÔ∏è ‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      }).join('');

      updateLastUpdatedText();
    }

    function openImageModal(imageUrl) {
      const img = (imageUrl || '').replace(/&amp;/g, '&');
      document.getElementById('modalImage').src = img;
      document.getElementById('imageModal').classList.add('active');
    }

    function showViewer() {
      document.getElementById('viewerSection').style.display = 'block';
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('adminSection').style.display = 'none';
      loadProducts(filterAndRenderViewer);
    }

    function showLogin() {
      document.getElementById('viewerSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('adminSection').style.display = 'none';
    }

    function showAdmin() {
      document.getElementById('viewerSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('adminSection').style.display = 'block';
      loadProducts(renderAdminTable);
    }

    function toggleAddForm() {
      const formCard = document.getElementById('addProductCard');
      const isVisible = formCard.style.display !== 'none';
      if (isVisible) {
        formCard.style.display = 'none';
        document.getElementById('addProductForm').reset();
      } else {
        formCard.style.display = 'block';
        formCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    window.editProduct = function (index) {
      const product = allProducts[index];
      Swal.fire({
        title: '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
        html: `
          <div style="text-align: left;">
            <div class="form-group">
              <label>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <input id="editSku" class="swal2-input"
                value="${escapeHtml(product.sku)}"
                readonly style="background:#f5f5f5;">
            </div>
            <div class="form-group">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <input id="editName" class="swal2-input"
                value="${escapeHtml(product.name)}">
            </div>
            <div class="form-group">
              <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <input id="editQuantity" class="swal2-input"
                type="number" min="0" value="${product.quantity}">
            </div>
            <div class="form-group">
              <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
              <select id="editStatus" class="swal2-select"
                style="display:block;width:100%;padding:12px;border:1px solid #d9d9d9;border-radius:5px;font-size:16px;background:white;cursor:pointer;margin-top:5px;">
                <option value="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á" ${product.status === '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á' ? 'selected' : ''}>‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á</option>
                <option value="‡∏´‡∏°‡∏î" ${product.status === '‡∏´‡∏°‡∏î' ? 'selected' : ''}>‚ö†Ô∏è ‡∏´‡∏°‡∏î</option>
                <option value="‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢" ${product.status === '‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢' ? 'selected' : ''}>üì¶ ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏Å‡∏î‡∏±‡∏á‡πÑ‡∏ó‡∏¢</option>
                <option value="‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" ${product.status === '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á' ? 'selected' : ''}>üöö ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
              </select>
            </div>
            <div class="form-group">
              <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ</label>
              <input id="editImageUrl" class="swal2-input"
                value="${escapeHtml(product.imageUrl)}">
            </div>
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
        confirmButtonColor: '#ff69b4',
        preConfirm: () => {
          const name = document.getElementById('editName').value.trim();
          const quantity = parseInt(document.getElementById('editQuantity').value, 10);
          const status = document.getElementById('editStatus').value;
          const raw = document.getElementById('editImageUrl').value.trim();
          const imageUrl = normalizeImageUrl(raw);

          if (!name || !status) {
            Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            return false;
          }
          if (Number.isNaN(quantity) || quantity < 0) {
            Swal.showValidationMessage('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 0');
            return false;
          }
          if (!imageUrl || !imageUrl.startsWith('http')) {
            Swal.showValidationMessage('‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            return false;
          }

          return { sku: product.sku, name, quantity, status, imageUrl };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          updateProduct(result.value);
        }
      });
    };

    function updateProduct(data) {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      const callbackName = 'jsonpCallback_' + Date.now();
      window[callbackName] = function (response) {
        delete window[callbackName];
        document.body.removeChild(script);
        Swal.close();

        if (response && response.ok) {
          Swal.fire({
            icon: 'success',
            title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
            confirmButtonColor: '#ff69b4'
          });
          loadProducts(renderAdminTable);
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: response?.msg || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ',
            confirmButtonColor: '#ff69b4'
          });
        }
      };

      const params = new URLSearchParams({
        action: 'update',
        adminId: ADMIN_ID,
        adminPassword: ADMIN_PASSWORD,
        sku: data.sku,
        name: data.name,
        quantity: data.quantity,
        status: data.status,
        imageUrl: data.imageUrl,
        callback: callbackName
      });

      const script = document.createElement('script');
      script.src = `${APPS_SCRIPT_URL}?${params.toString()}`;
      script.onerror = function () {
        delete window[callbackName];
        Swal.close();
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#ff69b4'
        });
      };
      document.body.appendChild(script);
    }

    window.deleteProduct = function (sku) {
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
        text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${sku} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: '‡∏•‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (!result.isConfirmed) return;

        Swal.fire({
          title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const callbackName = 'jsonpCallback_' + Date.now();
        window[callbackName] = function (response) {
          delete window[callbackName];
          document.body.removeChild(script);
          Swal.close();

          if (response && response.ok) {
            Swal.fire({
              icon: 'success',
              title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
              text: '‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
              confirmButtonColor: '#ff69b4'
            });
            loadProducts(renderAdminTable);
          } else {
            Swal.fire({
              icon: 'error',
              title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
              text: response?.msg || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ',
              confirmButtonColor: '#ff69b4'
            });
          }
        };

        const params = new URLSearchParams({
          action: 'delete',
          adminId: ADMIN_ID,
          adminPassword: ADMIN_PASSWORD,
          sku: sku,
          callback: callbackName
        });

        const script = document.createElement('script');
        script.src = `${APPS_SCRIPT_URL}?${params.toString()}`;
        script.onerror = function () {
          delete window[callbackName];
          Swal.close();
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
            confirmButtonColor: '#ff69b4'
          });
        };
        document.body.appendChild(script);
      });
    };

    // Event Listeners
    document.getElementById('goToAdminBtn').addEventListener('click', showLogin);
    document.getElementById('backToViewerBtn').addEventListener('click', showViewer);

    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const adminId = document.getElementById('adminId').value;
      const adminPassword = document.getElementById('adminPassword').value;

      if (adminId === ADMIN_ID && adminPassword === ADMIN_PASSWORD) {
        sessionStorage.setItem('isAdminLoggedIn', 'true');
        showAdmin();
      } else {
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
          text: 'Admin ID ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          confirmButtonColor: '#ff69b4'
        });
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', function () {
      sessionStorage.removeItem('isAdminLoggedIn');
      document.getElementById('adminId').value = '';
      document.getElementById('adminPassword').value = '';
      showViewer();
    });

    document.getElementById('toggleAddFormBtn').addEventListener('click', toggleAddForm);
    document.getElementById('cancelAddBtn').addEventListener('click', toggleAddForm);

    document.getElementById('addProductForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const sku = document.getElementById('addSku').value.trim();
      const name = document.getElementById('addName').value.trim();
      const quantity = parseInt(document.getElementById('addQuantity').value, 10);
      const status = document.getElementById('addStatus').value.trim();
      const raw = document.getElementById('addImageUrl').value.trim();
      const imageUrl = normalizeImageUrl(raw);

      if (!sku || !name) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
          confirmButtonColor: '#ff69b4'
        });
        return;
      }

      if (Number.isNaN(quantity) || quantity < 0) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 0',
          confirmButtonColor: '#ff69b4'
        });
        return;
      }

      if (!imageUrl || !imageUrl.startsWith('http')) {
        Swal.fire({
          icon: 'error',
          title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          text: '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
          confirmButtonColor: '#ff69b4'
        });
        return;
      }

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      const callbackName = 'jsonpCallback_' + Date.now();
      window[callbackName] = function (response) {
        delete window[callbackName];
        document.body.removeChild(script);
        Swal.close();

        if (response && response.ok) {
          Swal.fire({
            icon: 'success',
            title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            text: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
            confirmButtonColor: '#ff69b4'
          });
          document.getElementById('addProductForm').reset();
          toggleAddForm();
          loadProducts(renderAdminTable);
        } else {
          Swal.fire({
            icon: 'error',
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: response?.msg || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ',
            confirmButtonColor: '#ff69b4'
          });
        }
      };

      const params = new URLSearchParams({
        action: 'add',
        adminId: ADMIN_ID,
        adminPassword: ADMIN_PASSWORD,
        sku: sku,
        name: name,
        quantity: quantity,
        status: status,
        imageUrl: imageUrl,
        callback: callbackName
      });

      const script = document.createElement('script');
      script.src = `${APPS_SCRIPT_URL}?${params.toString()}`;
      script.onerror = function () {
        delete window[callbackName];
        Swal.close();
        Swal.fire({
          icon: 'error',
          title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
          text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ',
          confirmButtonColor: '#ff69b4'
        });
      };
      document.body.appendChild(script);
    });

    document.getElementById('refreshBtn').addEventListener('click', function () {
      loadProducts(renderAdminTable);
    });

    document.getElementById('searchInput').addEventListener('input', function () {
      currentViewerPage = 1;
      filterAndRenderViewer();
    });

    document.getElementById('statusFilterSelect').addEventListener('change', function () {
      currentFilter = this.value;
      currentViewerPage = 1;
      filterAndRenderViewer();
    });

    document.getElementById('prevPageBtn').addEventListener('click', function () {
      if (currentViewerPage > 1) {
        currentViewerPage--;
        filterAndRenderViewer();
      }
    });

    document.getElementById('nextPageBtn').addEventListener('click', function () {
      currentViewerPage++;
      filterAndRenderViewer();
    });

    document.getElementById('closeModal').addEventListener('click', function () {
      document.getElementById('imageModal').classList.remove('active');
    });

    document.getElementById('imageModal').addEventListener('click', function (e) {
      if (e.target === this) {
        this.classList.remove('active');
      }
    });

    // Canva config (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô GitHub Pages ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏¢ ‡πÜ)
    async function onConfigChange(config) {
      const pageTitle = config.page_title || defaultConfig.page_title;
      const shopName = config.shop_name || defaultConfig.shop_name;

      const pageTitleEl = document.getElementById('pageTitle');
      const shopNameEl = document.getElementById('shopName');
      const adminPageTitleEl = document.getElementById('adminPageTitle');
      const adminShopNameEl = document.getElementById('adminShopName');

      if (pageTitleEl) pageTitleEl.textContent = pageTitle;
      if (shopNameEl) shopNameEl.innerHTML = '‚≠ê ' + shopName + ' ‚≠ê';
      if (adminPageTitleEl) adminPageTitleEl.textContent = pageTitle;
      if (adminShopNameEl) adminShopNameEl.innerHTML = '‚≠ê ' + shopName + ' ‚≠ê';
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: () => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["page_title", config.page_title || defaultConfig.page_title],
          ["shop_name", config.shop_name || defaultConfig.shop_name]
        ])
      });
    }

    // Dark Mode
    function updateThemeToggleButtons(isDark) {
      const buttons = [
        document.getElementById('themeToggleViewer'),
        document.getElementById('themeToggleAdmin')
      ];

      buttons.forEach(btn => {
        if (!btn) return;
        const icon = btn.querySelector('.theme-icon');
        const text = btn.querySelector('.theme-text');
        if (isDark) {
          if (icon) icon.textContent = '‚òÄÔ∏è';
          if (text) text.textContent = 'Light';
        } else {
          if (icon) icon.textContent = 'üåô';
          if (text) text.textContent = 'Dark';
        }
      });
    }

    function toggleDarkMode() {
      const body = document.body;
      const isDark = body.classList.toggle('dark-mode');
      localStorage.setItem('themeMode', isDark ? 'dark' : 'light');
      updateThemeToggleButtons(isDark);
    }

    function initTheme() {
      const savedTheme = localStorage.getItem('themeMode');
      const body = document.body;
      if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
        updateThemeToggleButtons(true);
      } else {
        body.classList.remove('dark-mode');
        updateThemeToggleButtons(false);
      }
    }

    initTheme();

    document.getElementById('themeToggleViewer')?.addEventListener('click', toggleDarkMode);
    document.getElementById('themeToggleAdmin')?.addEventListener('click', toggleDarkMode);

    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    if (sessionStorage.getItem('isAdminLoggedIn') === 'true') {
      showAdmin();
    } else {
      showViewer();
    }
  </script>
</body>
</html>
